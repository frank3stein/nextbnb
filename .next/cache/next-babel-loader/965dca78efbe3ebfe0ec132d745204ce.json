{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n// import Houses from \"../houses.json\";\nimport axios from \"axios\";\nimport fetch from \"isomorphic-unfetch\";\nimport Head from \"next/head\";\nimport Layout from \"../../components/Layout\";\nimport DateRangePicker from \"../../components/DateRangePicker\";\nimport calculateNights from \"../../utils/calculate-nights.js\";\nimport { useState } from \"react\";\nimport { useStoreActions, useStoreState } from \"easy-peasy\";\n\nconst getBookedDates = async house => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\"http://localhost:3000/api/houses/booked\", {\n      houseId\n    });\n\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\"http://localhost:3000/api/houses/check\", {\n      houseId,\n      startDate,\n      endDate\n    });\n\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n\n    if (response.data.message === \"busy\") return false;\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst House = ({\n  house,\n  bookedDates\n}) => {\n  const user = useStoreState(state => state.user.user);\n  const setShowLoginModal = useStoreActions(actions => actions.modals.setShowLoginModal);\n  const {\n    0: dateChosen,\n    1: setDateChosen\n  } = useState(false);\n  const {\n    0: stayNights,\n    1: setStayNights\n  } = useState(0);\n  const {\n    0: startDate,\n    1: setStartDate\n  } = useState();\n  const {\n    0: endDate,\n    1: setEndDate\n  } = useState();\n\n  const content = __jsx(\"div\", {\n    className: \"jsx-2306727923\" + \" \" + \"container\"\n  }, __jsx(Head, null, __jsx(\"title\", {\n    className: \"jsx-2306727923\"\n  }, house.title)), __jsx(\"article\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"img\", {\n    src: house.picture,\n    width: \"100%\",\n    alt: \"House picture\",\n    className: \"jsx-2306727923\"\n  }), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, house.type, \" - \", house.town), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, house.title)), __jsx(\"aside\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Add dates for prices.\"), __jsx(DateRangePicker, {\n    datesChanged: (startDate, endDate) => {\n      setDateChosen(true);\n      setStayNights(calculateNights(startDate, endDate));\n      console.log(startDate, endDate);\n      setStartDate(startDate);\n      setEndDate(endDate);\n    },\n    bookedDates: bookedDates\n  }), dateChosen && __jsx(\"div\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Price per night\"), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"$\", house.price), __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Total price for the booking\"), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"$\", (stayNights * house.price).toFixed(2)), user ? __jsx(\"button\", {\n    onClick: async () => {\n      if (!(await canReserve(house.id, startDate, endDate))) {\n        alert(\"The dates chosen are invalid\");\n        return;\n      }\n\n      try {\n        const response = await axios.post(\"/api/houses/reserve\", {\n          houseId: house.id,\n          startDate,\n          endDate\n        });\n\n        if (response.data.status === \"error\") {\n          alert(response.data.message);\n          return;\n        }\n      } catch (err) {\n        console.log(err);\n        return;\n      }\n    },\n    className: \"jsx-2306727923\" + \" \" + \"reserve\"\n  }, \"Reserve\") : __jsx(\"button\", {\n    onClick: () => {\n      setShowLoginModal();\n    },\n    className: \"jsx-2306727923\" + \" \" + \"reserve\"\n  }, \"Log in to Reserve\")) || __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"Please select dates\")), house.reviewsCount ? __jsx(\"div\", {\n    className: \"jsx-2306727923\" + \" \" + \"reviews\"\n  }, __jsx(\"h3\", {\n    className: \"jsx-2306727923\"\n  }, house.reviewsCount, \" Reviews\"), house.reviews.map((review, index) => {\n    return __jsx(\"div\", {\n      key: index,\n      className: \"jsx-2306727923\"\n    }, __jsx(\"p\", {\n      className: \"jsx-2306727923\"\n    }, new Date(review.createdAt).toDateString()), __jsx(\"p\", {\n      className: \"jsx-2306727923\"\n    }, review.comment));\n  })) : __jsx(React.Fragment, null), __jsx(_JSXStyle, {\n    id: \"2306727923\"\n  }, \".container.jsx-2306727923{display:grid;grid-template-columns:60% 40%;grid-gap:30px;}aside.jsx-2306727923{border:1px solid #ccc;padding:20px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2VtaWwvZGV2ZWxvcG1lbnQvbmV4dGJuYi9wYWdlcy9Ib3VzZXMvW2lkXS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtSmtCLEFBR3dCLEFBTVMsYUFMUSxTQU1qQixhQUNmLFFBTmdCLGNBQ2hCIiwiZmlsZSI6Ii9ob21lL2VtaWwvZGV2ZWxvcG1lbnQvbmV4dGJuYi9wYWdlcy9Ib3VzZXMvW2lkXS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBIb3VzZXMgZnJvbSBcIi4uL2hvdXNlcy5qc29uXCI7XG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgZmV0Y2ggZnJvbSBcImlzb21vcnBoaWMtdW5mZXRjaFwiO1xuaW1wb3J0IEhlYWQgZnJvbSBcIm5leHQvaGVhZFwiO1xuaW1wb3J0IExheW91dCBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9MYXlvdXRcIjtcbmltcG9ydCBEYXRlUmFuZ2VQaWNrZXIgZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvRGF0ZVJhbmdlUGlja2VyXCI7XG5pbXBvcnQgY2FsY3VsYXRlTmlnaHRzIGZyb20gXCIuLi8uLi91dGlscy9jYWxjdWxhdGUtbmlnaHRzLmpzXCI7XG5pbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlU3RvcmVBY3Rpb25zLCB1c2VTdG9yZVN0YXRlIH0gZnJvbSBcImVhc3ktcGVhc3lcIjtcblxuY29uc3QgZ2V0Qm9va2VkRGF0ZXMgPSBhc3luYyBob3VzZSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgaG91c2VJZCA9IGhvdXNlLmlkO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgIFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvYm9va2VkXCIsXG4gICAgICB7IGhvdXNlSWQgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZS5kYXRhLmRhdGVzO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuY29uc3QgY2FuUmVzZXJ2ZSA9IGFzeW5jIChob3VzZUlkLCBzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBob3VzZUlkID0gaG91c2UuaWQ7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2hvdXNlcy9jaGVja1wiLFxuICAgICAgeyBob3VzZUlkLCBzdGFydERhdGUsIGVuZERhdGUgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gXCJidXN5XCIpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IEhvdXNlID0gKHsgaG91c2UsIGJvb2tlZERhdGVzIH0pID0+IHtcbiAgY29uc3QgdXNlciA9IHVzZVN0b3JlU3RhdGUoc3RhdGUgPT4gc3RhdGUudXNlci51c2VyKTtcbiAgY29uc3Qgc2V0U2hvd0xvZ2luTW9kYWwgPSB1c2VTdG9yZUFjdGlvbnMoXG4gICAgYWN0aW9ucyA9PiBhY3Rpb25zLm1vZGFscy5zZXRTaG93TG9naW5Nb2RhbFxuICApO1xuICBjb25zdCBbZGF0ZUNob3Nlbiwgc2V0RGF0ZUNob3Nlbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtzdGF5TmlnaHRzLCBzZXRTdGF5TmlnaHRzXSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbc3RhcnREYXRlLCBzZXRTdGFydERhdGVdID0gdXNlU3RhdGUoKTtcbiAgY29uc3QgW2VuZERhdGUsIHNldEVuZERhdGVdID0gdXNlU3RhdGUoKTtcbiAgY29uc3QgY29udGVudCA9IChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnRhaW5lclwiPlxuICAgICAgPEhlYWQ+XG4gICAgICAgIDx0aXRsZT57aG91c2UudGl0bGV9PC90aXRsZT5cbiAgICAgIDwvSGVhZD5cbiAgICAgIDxhcnRpY2xlPlxuICAgICAgICA8aW1nIHNyYz17aG91c2UucGljdHVyZX0gd2lkdGg9XCIxMDAlXCIgYWx0PVwiSG91c2UgcGljdHVyZVwiIC8+XG4gICAgICAgIDxwPlxuICAgICAgICAgIHtob3VzZS50eXBlfSAtIHtob3VzZS50b3dufVxuICAgICAgICA8L3A+XG4gICAgICAgIDxwPntob3VzZS50aXRsZX08L3A+XG4gICAgICAgIHsvKiA8cD5cbiAgICAgICAgICB7aG91c2UucmF0aW5nfSAoe2hvdXNlLnJldmlld3NDb3VudH0pXG4gICAgICAgIDwvcD4gLy8gcmVtb3ZlZCovfVxuICAgICAgPC9hcnRpY2xlPlxuICAgICAgPGFzaWRlPlxuICAgICAgICA8aDI+QWRkIGRhdGVzIGZvciBwcmljZXMuPC9oMj5cbiAgICAgICAgPERhdGVSYW5nZVBpY2tlclxuICAgICAgICAgIGRhdGVzQ2hhbmdlZD17KHN0YXJ0RGF0ZSwgZW5kRGF0ZSkgPT4ge1xuICAgICAgICAgICAgc2V0RGF0ZUNob3Nlbih0cnVlKTtcbiAgICAgICAgICAgIHNldFN0YXlOaWdodHMoY2FsY3VsYXRlTmlnaHRzKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgICAgICAgIHNldFN0YXJ0RGF0ZShzdGFydERhdGUpO1xuICAgICAgICAgICAgc2V0RW5kRGF0ZShlbmREYXRlKTtcbiAgICAgICAgICB9fVxuICAgICAgICAgIGJvb2tlZERhdGVzPXtib29rZWREYXRlc31cbiAgICAgICAgLz5cbiAgICAgICAgeyhkYXRlQ2hvc2VuICYmIChcbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGgyPlByaWNlIHBlciBuaWdodDwvaDI+XG4gICAgICAgICAgICA8cD4ke2hvdXNlLnByaWNlfTwvcD5cbiAgICAgICAgICAgIDxoMj5Ub3RhbCBwcmljZSBmb3IgdGhlIGJvb2tpbmc8L2gyPlxuICAgICAgICAgICAgPHA+JHsoc3RheU5pZ2h0cyAqIGhvdXNlLnByaWNlKS50b0ZpeGVkKDIpfTwvcD5cbiAgICAgICAgICAgIHt1c2VyID8gKFxuICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicmVzZXJ2ZVwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17YXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKCEoYXdhaXQgY2FuUmVzZXJ2ZShob3VzZS5pZCwgc3RhcnREYXRlLCBlbmREYXRlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJUaGUgZGF0ZXMgY2hvc2VuIGFyZSBpbnZhbGlkXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcIi9hcGkvaG91c2VzL3Jlc2VydmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgIGhvdXNlSWQ6IGhvdXNlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICBlbmREYXRlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIFJlc2VydmVcbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicmVzZXJ2ZVwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgc2V0U2hvd0xvZ2luTW9kYWwoKTtcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgTG9nIGluIHRvIFJlc2VydmVcbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApKSB8fCA8cD5QbGVhc2Ugc2VsZWN0IGRhdGVzPC9wPn1cbiAgICAgIDwvYXNpZGU+XG4gICAgICB7aG91c2UucmV2aWV3c0NvdW50ID8gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJldmlld3NcIj5cbiAgICAgICAgICA8aDM+e2hvdXNlLnJldmlld3NDb3VudH0gUmV2aWV3czwvaDM+XG5cbiAgICAgICAgICB7aG91c2UucmV2aWV3cy5tYXAoKHJldmlldywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0+XG4gICAgICAgICAgICAgICAgPHA+e25ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvRGF0ZVN0cmluZygpfTwvcD5cbiAgICAgICAgICAgICAgICA8cD57cmV2aWV3LmNvbW1lbnR9PC9wPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSA6IChcbiAgICAgICAgPD48Lz5cbiAgICAgICl9XG4gICAgICA8c3R5bGUganN4PntgXG4gICAgICAgIC5jb250YWluZXIge1xuICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiA2MCUgNDAlO1xuICAgICAgICAgIGdyaWQtZ2FwOiAzMHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgYXNpZGUge1xuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XG4gICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgfVxuICAgICAgYH08L3N0eWxlPlxuICAgIDwvZGl2PlxuICApO1xuICByZXR1cm4gPExheW91dCBjb250ZW50PXtjb250ZW50fT48L0xheW91dD47XG59O1xuXG4vLyBIb3VzZS5nZXRJbml0aWFsUHJvcHMgPSAoeyBxdWVyeSB9KSA9PiB7XG4vLyAgIC8vIG91ciBxdWVyeSBpcyB0YWtlbiBmcm9tIHRoZSB1cmxcbi8vICAgY29uc3QgeyBpZCB9ID0gcXVlcnk7IC8vIGhvdXNlcy9xdWVyeVBhcmFtZXRlcnMuIEl0IGlzIGluIHRoZSBmaWxlIG5hbWUgW2lkXS5qc1xuLy8gICBjb25zb2xlLmxvZyhxdWVyeSk7XG4vLyAgIHJldHVybiB7XG4vLyAgICAgaG91c2U6IEhvdXNlcy5maWx0ZXIoaG91c2UgPT4gaG91c2UuaWQgPT09IGlkKVswXVxuLy8gICB9O1xuLy8gfTtcblxuSG91c2UuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgKHsgcXVlcnkgfSkgPT4ge1xuICBjb25zdCB7IGlkIH0gPSBxdWVyeTtcblxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvJHtpZH1gKTtcbiAgY29uc3QgaG91c2UgPSBhd2FpdCByZXMuanNvbigpO1xuXG4gIGNvbnN0IGJvb2tlZERhdGVzID0gYXdhaXQgZ2V0Qm9va2VkRGF0ZXMoaG91c2UpO1xuXG4gIHJldHVybiB7XG4gICAgaG91c2UsXG4gICAgYm9va2VkRGF0ZXNcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEhvdXNlO1xuIl19 */\\n/*@ sourceURL=/home/emil/development/nextbnb/pages/Houses/[id].js */\"));\n\n  return __jsx(Layout, {\n    content: content\n  });\n}; // House.getInitialProps = ({ query }) => {\n//   // our query is taken from the url\n//   const { id } = query; // houses/queryParameters. It is in the file name [id].js\n//   console.log(query);\n//   return {\n//     house: Houses.filter(house => house.id === id)[0]\n//   };\n// };\n\n\nHouse.getInitialProps = async ({\n  query\n}) => {\n  const {\n    id\n  } = query;\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n  const bookedDates = await getBookedDates(house);\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;","map":{"version":3,"sources":["/home/emil/development/nextbnb/pages/Houses/[id].js"],"names":["axios","fetch","Head","Layout","DateRangePicker","calculateNights","useState","useStoreActions","useStoreState","getBookedDates","house","houseId","id","response","post","data","status","alert","message","dates","error","console","canReserve","startDate","endDate","House","bookedDates","user","state","setShowLoginModal","actions","modals","dateChosen","setDateChosen","stayNights","setStayNights","setStartDate","setEndDate","content","title","picture","type","town","log","price","toFixed","err","reviewsCount","reviews","map","review","index","Date","createdAt","toDateString","comment","getInitialProps","query","res","json"],"mappings":"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","sourcesContent":["// import Houses from \"../houses.json\";\nimport axios from \"axios\";\nimport fetch from \"isomorphic-unfetch\";\nimport Head from \"next/head\";\nimport Layout from \"../../components/Layout\";\nimport DateRangePicker from \"../../components/DateRangePicker\";\nimport calculateNights from \"../../utils/calculate-nights.js\";\nimport { useState } from \"react\";\nimport { useStoreActions, useStoreState } from \"easy-peasy\";\n\nconst getBookedDates = async house => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\n      \"http://localhost:3000/api/houses/booked\",\n      { houseId }\n    );\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\n      \"http://localhost:3000/api/houses/check\",\n      { houseId, startDate, endDate }\n    );\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n\n    if (response.data.message === \"busy\") return false;\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst House = ({ house, bookedDates }) => {\n  const user = useStoreState(state => state.user.user);\n  const setShowLoginModal = useStoreActions(\n    actions => actions.modals.setShowLoginModal\n  );\n  const [dateChosen, setDateChosen] = useState(false);\n  const [stayNights, setStayNights] = useState(0);\n  const [startDate, setStartDate] = useState();\n  const [endDate, setEndDate] = useState();\n  const content = (\n    <div className=\"container\">\n      <Head>\n        <title>{house.title}</title>\n      </Head>\n      <article>\n        <img src={house.picture} width=\"100%\" alt=\"House picture\" />\n        <p>\n          {house.type} - {house.town}\n        </p>\n        <p>{house.title}</p>\n        {/* <p>\n          {house.rating} ({house.reviewsCount})\n        </p> // removed*/}\n      </article>\n      <aside>\n        <h2>Add dates for prices.</h2>\n        <DateRangePicker\n          datesChanged={(startDate, endDate) => {\n            setDateChosen(true);\n            setStayNights(calculateNights(startDate, endDate));\n            console.log(startDate, endDate);\n            setStartDate(startDate);\n            setEndDate(endDate);\n          }}\n          bookedDates={bookedDates}\n        />\n        {(dateChosen && (\n          <div>\n            <h2>Price per night</h2>\n            <p>${house.price}</p>\n            <h2>Total price for the booking</h2>\n            <p>${(stayNights * house.price).toFixed(2)}</p>\n            {user ? (\n              <button\n                className=\"reserve\"\n                onClick={async () => {\n                  if (!(await canReserve(house.id, startDate, endDate))) {\n                    alert(\"The dates chosen are invalid\");\n                    return;\n                  }\n\n                  try {\n                    const response = await axios.post(\"/api/houses/reserve\", {\n                      houseId: house.id,\n                      startDate,\n                      endDate\n                    });\n\n                    if (response.data.status === \"error\") {\n                      alert(response.data.message);\n                      return;\n                    }\n                  } catch (err) {\n                    console.log(err);\n                    return;\n                  }\n                }}\n              >\n                Reserve\n              </button>\n            ) : (\n              <button\n                className=\"reserve\"\n                onClick={() => {\n                  setShowLoginModal();\n                }}\n              >\n                Log in to Reserve\n              </button>\n            )}\n          </div>\n        )) || <p>Please select dates</p>}\n      </aside>\n      {house.reviewsCount ? (\n        <div className=\"reviews\">\n          <h3>{house.reviewsCount} Reviews</h3>\n\n          {house.reviews.map((review, index) => {\n            return (\n              <div key={index}>\n                <p>{new Date(review.createdAt).toDateString()}</p>\n                <p>{review.comment}</p>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <></>\n      )}\n      <style jsx>{`\n        .container {\n          display: grid;\n          grid-template-columns: 60% 40%;\n          grid-gap: 30px;\n        }\n\n        aside {\n          border: 1px solid #ccc;\n          padding: 20px;\n        }\n      `}</style>\n    </div>\n  );\n  return <Layout content={content}></Layout>;\n};\n\n// House.getInitialProps = ({ query }) => {\n//   // our query is taken from the url\n//   const { id } = query; // houses/queryParameters. It is in the file name [id].js\n//   console.log(query);\n//   return {\n//     house: Houses.filter(house => house.id === id)[0]\n//   };\n// };\n\nHouse.getInitialProps = async ({ query }) => {\n  const { id } = query;\n\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n\n  const bookedDates = await getBookedDates(house);\n\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;\n"]},"metadata":{},"sourceType":"module"}