{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n// import Houses from \"../houses.json\";\nimport axios from \"axios\";\nimport fetch from \"isomorphic-unfetch\";\nimport Head from \"next/head\";\nimport Layout from \"../../components/Layout\";\nimport DateRangePicker from \"../../components/DateRangePicker\";\nimport calculateNights from \"../../utils/calculate-nights.js\";\nimport { useState } from \"react\";\nimport { useStoreActions, useStoreState } from \"easy-peasy\"; // import { Stripe } from \"stripe\";\n\nvar getBookedDates = function getBookedDates(house) {\n  var houseId, response;\n  return _regeneratorRuntime.async(function getBookedDates$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          houseId = house.id;\n          _context.next = 4;\n          return _regeneratorRuntime.awrap(axios.post(\"http://localhost:3000/api/houses/booked\", {\n            houseId: houseId\n          }));\n\n        case 4:\n          response = _context.sent;\n\n          if (!(response.data.status === \"error\")) {\n            _context.next = 8;\n            break;\n          }\n\n          alert(response.data.message);\n          return _context.abrupt(\"return\");\n\n        case 8:\n          return _context.abrupt(\"return\", response.data.dates);\n\n        case 11:\n          _context.prev = 11;\n          _context.t0 = _context[\"catch\"](0);\n          console.error(_context.t0);\n          return _context.abrupt(\"return\");\n\n        case 15:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 11]]);\n};\n\nvar canReserve = function canReserve(houseId, startDate, endDate) {\n  var response;\n  return _regeneratorRuntime.async(function canReserve$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return _regeneratorRuntime.awrap(axios.post(\"http://localhost:3000/api/houses/check\", {\n            houseId: houseId,\n            startDate: startDate,\n            endDate: endDate\n          }));\n\n        case 3:\n          response = _context2.sent;\n\n          if (!(response.data.status === \"error\")) {\n            _context2.next = 7;\n            break;\n          }\n\n          alert(response.data.message);\n          return _context2.abrupt(\"return\");\n\n        case 7:\n          if (!(response.data.message === \"busy\")) {\n            _context2.next = 9;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", false);\n\n        case 9:\n          return _context2.abrupt(\"return\", true);\n\n        case 12:\n          _context2.prev = 12;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.error(_context2.t0);\n          return _context2.abrupt(\"return\");\n\n        case 16:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 12]]);\n};\n\nvar getDatesBetweenDates = function getDatesBetweenDates(startDate, endDate) {\n  var dates = [];\n\n  while (startDate < endDate) {\n    dates = [].concat(_toConsumableArray(dates), [new Date(startDate)]);\n    startDate.setDate(startDate.getDate() + 1);\n  }\n\n  dates = [].concat(_toConsumableArray(dates), [endDate]);\n  return dates;\n};\n\nvar House = function House(_ref) {\n  var house = _ref.house,\n      bookedDates = _ref.bookedDates;\n  var user = useStoreState(function (state) {\n    return state.user.user;\n  });\n  var setShowLoginModal = useStoreActions(function (actions) {\n    return actions.modals.setShowLoginModal;\n  });\n\n  var _useState = useState(false),\n      dateChosen = _useState[0],\n      setDateChosen = _useState[1];\n\n  var _useState2 = useState(0),\n      stayNights = _useState2[0],\n      setStayNights = _useState2[1];\n\n  var _useState3 = useState(),\n      startDate = _useState3[0],\n      setStartDate = _useState3[1];\n\n  var _useState4 = useState(),\n      endDate = _useState4[0],\n      setEndDate = _useState4[1];\n\n  var content = __jsx(\"div\", {\n    className: \"jsx-2306727923\" + \" \" + \"container\"\n  }, __jsx(Head, null, __jsx(\"title\", {\n    className: \"jsx-2306727923\"\n  }, house.title)), __jsx(\"article\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"img\", {\n    src: house.picture,\n    width: \"100%\",\n    alt: \"House picture\",\n    className: \"jsx-2306727923\"\n  }), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, house.type, \" - \", house.town), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, house.title)), __jsx(\"aside\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Add dates for prices.\"), __jsx(DateRangePicker, {\n    datesChanged: function datesChanged(startDate, endDate) {\n      setDateChosen(true);\n      setStayNights(calculateNights(startDate, endDate));\n      console.log(startDate, endDate);\n      setStartDate(startDate);\n      setEndDate(endDate);\n    },\n    bookedDates: bookedDates\n  }), dateChosen && __jsx(\"div\", {\n    className: \"jsx-2306727923\"\n  }, __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Price per night\"), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"$\", house.price), __jsx(\"h2\", {\n    className: \"jsx-2306727923\"\n  }, \"Total price for the booking\"), __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"$\", (stayNights * house.price).toFixed(2)), user ? __jsx(\"button\", {\n    onClick: function _callee() {\n      var sessionResponse, stripePublicKey, sessionId, reserveResponse, response, stripe, _ref2, error;\n\n      return _regeneratorRuntime.async(function _callee$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(canReserve(house.id, startDate, endDate));\n\n            case 2:\n              if (_context3.sent) {\n                _context3.next = 5;\n                break;\n              }\n\n              alert(\"The dates chosen are invalid\");\n              return _context3.abrupt(\"return\");\n\n            case 5:\n              _context3.prev = 5;\n              _context3.next = 8;\n              return _regeneratorRuntime.awrap(axios.post(\"/api/stripe/session\", {\n                amount: house.price * getDatesBetweenDates(startDate, endDate).length\n              }));\n\n            case 8:\n              sessionResponse = _context3.sent;\n\n              if (!(sessionResponse.data.status === \"error\")) {\n                _context3.next = 12;\n                break;\n              }\n\n              alert(sessionResponse.data.message);\n              return _context3.abrupt(\"return\");\n\n            case 12:\n              stripePublicKey = sessionResponse.data.stripePublicKey;\n              sessionId = sessionResponse.data.sessionId;\n              _context3.next = 16;\n              return _regeneratorRuntime.awrap(axios.post(\"/api/houses/reserve\", {\n                houseId: house.id,\n                startDate: startDate,\n                endDate: endDate,\n                sessionId: sessionId\n              }));\n\n            case 16:\n              reserveResponse = _context3.sent;\n              _context3.next = 19;\n              return _regeneratorRuntime.awrap(axios.post(\"/api/houses/reserve\", {\n                houseId: house.id,\n                startDate: startDate,\n                endDate: endDate,\n                sessionId: sessionId\n              }));\n\n            case 19:\n              response = _context3.sent;\n\n              if (!(response.data.status === \"error\")) {\n                _context3.next = 23;\n                break;\n              }\n\n              alert(response.data.message);\n              return _context3.abrupt(\"return\");\n\n            case 23:\n              stripe = Stripe(stripePublicKey);\n              _context3.next = 26;\n              return _regeneratorRuntime.awrap(stripe.redirectToCheckout({\n                sessionId: sessionId\n              }));\n\n            case 26:\n              _ref2 = _context3.sent;\n              error = _ref2.error;\n              _context3.next = 34;\n              break;\n\n            case 30:\n              _context3.prev = 30;\n              _context3.t0 = _context3[\"catch\"](5);\n              console.log(_context3.t0);\n              return _context3.abrupt(\"return\");\n\n            case 34:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, [[5, 30]]);\n    },\n    className: \"jsx-2306727923\" + \" \" + \"reserve\"\n  }, \"Reserve\") : __jsx(\"button\", {\n    onClick: function onClick() {\n      setShowLoginModal();\n    },\n    className: \"jsx-2306727923\" + \" \" + \"reserve\"\n  }, \"Log in to Reserve\")) || __jsx(\"p\", {\n    className: \"jsx-2306727923\"\n  }, \"Please select dates\")), house.reviewsCount ? __jsx(\"div\", {\n    className: \"jsx-2306727923\" + \" \" + \"reviews\"\n  }, __jsx(\"h3\", {\n    className: \"jsx-2306727923\"\n  }, house.reviewsCount, \" Reviews\"), house.reviews.map(function (review, index) {\n    return __jsx(\"div\", {\n      key: index,\n      className: \"jsx-2306727923\"\n    }, __jsx(\"p\", {\n      className: \"jsx-2306727923\"\n    }, new Date(review.createdAt).toDateString()), __jsx(\"p\", {\n      className: \"jsx-2306727923\"\n    }, review.comment));\n  })) : __jsx(React.Fragment, null), __jsx(_JSXStyle, {\n    id: \"2306727923\"\n  }, \".container.jsx-2306727923{display:grid;grid-template-columns:60% 40%;grid-gap:30px;}aside.jsx-2306727923{border:1px solid #ccc;padding:20px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2VtaWwvZGV2ZWxvcG1lbnQvbmV4dGJuYi9wYWdlcy9Ib3VzZXMvW2lkXS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0TGtCLEFBR3dCLEFBTVMsYUFMUSxTQU1qQixhQUNmLFFBTmdCLGNBQ2hCIiwiZmlsZSI6Ii9ob21lL2VtaWwvZGV2ZWxvcG1lbnQvbmV4dGJuYi9wYWdlcy9Ib3VzZXMvW2lkXS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBIb3VzZXMgZnJvbSBcIi4uL2hvdXNlcy5qc29uXCI7XG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgZmV0Y2ggZnJvbSBcImlzb21vcnBoaWMtdW5mZXRjaFwiO1xuaW1wb3J0IEhlYWQgZnJvbSBcIm5leHQvaGVhZFwiO1xuaW1wb3J0IExheW91dCBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9MYXlvdXRcIjtcbmltcG9ydCBEYXRlUmFuZ2VQaWNrZXIgZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvRGF0ZVJhbmdlUGlja2VyXCI7XG5pbXBvcnQgY2FsY3VsYXRlTmlnaHRzIGZyb20gXCIuLi8uLi91dGlscy9jYWxjdWxhdGUtbmlnaHRzLmpzXCI7XG5pbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlU3RvcmVBY3Rpb25zLCB1c2VTdG9yZVN0YXRlIH0gZnJvbSBcImVhc3ktcGVhc3lcIjtcbi8vIGltcG9ydCB7IFN0cmlwZSB9IGZyb20gXCJzdHJpcGVcIjtcblxuY29uc3QgZ2V0Qm9va2VkRGF0ZXMgPSBhc3luYyBob3VzZSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgaG91c2VJZCA9IGhvdXNlLmlkO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgIFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvYm9va2VkXCIsXG4gICAgICB7IGhvdXNlSWQgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSBcImVycm9yXCIpIHtcbiAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZS5kYXRhLmRhdGVzO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuY29uc3QgY2FuUmVzZXJ2ZSA9IGFzeW5jIChob3VzZUlkLCBzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvaG91c2VzL2NoZWNrXCIsXG4gICAgICB7IGhvdXNlSWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9XG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IFwiZXJyb3JcIikge1xuICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSBcImJ1c3lcIikgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuY29uc3QgZ2V0RGF0ZXNCZXR3ZWVuRGF0ZXMgPSAoc3RhcnREYXRlLCBlbmREYXRlKSA9PiB7XG4gIGxldCBkYXRlcyA9IFtdO1xuICB3aGlsZSAoc3RhcnREYXRlIDwgZW5kRGF0ZSkge1xuICAgIGRhdGVzID0gWy4uLmRhdGVzLCBuZXcgRGF0ZShzdGFydERhdGUpXTtcbiAgICBzdGFydERhdGUuc2V0RGF0ZShzdGFydERhdGUuZ2V0RGF0ZSgpICsgMSk7XG4gIH1cbiAgZGF0ZXMgPSBbLi4uZGF0ZXMsIGVuZERhdGVdO1xuICByZXR1cm4gZGF0ZXM7XG59O1xuXG5jb25zdCBIb3VzZSA9ICh7IGhvdXNlLCBib29rZWREYXRlcyB9KSA9PiB7XG4gIGNvbnN0IHVzZXIgPSB1c2VTdG9yZVN0YXRlKHN0YXRlID0+IHN0YXRlLnVzZXIudXNlcik7XG4gIGNvbnN0IHNldFNob3dMb2dpbk1vZGFsID0gdXNlU3RvcmVBY3Rpb25zKFxuICAgIGFjdGlvbnMgPT4gYWN0aW9ucy5tb2RhbHMuc2V0U2hvd0xvZ2luTW9kYWxcbiAgKTtcbiAgY29uc3QgW2RhdGVDaG9zZW4sIHNldERhdGVDaG9zZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc3RheU5pZ2h0cywgc2V0U3RheU5pZ2h0c10gPSB1c2VTdGF0ZSgwKTtcbiAgY29uc3QgW3N0YXJ0RGF0ZSwgc2V0U3RhcnREYXRlXSA9IHVzZVN0YXRlKCk7XG4gIGNvbnN0IFtlbmREYXRlLCBzZXRFbmREYXRlXSA9IHVzZVN0YXRlKCk7XG4gIGNvbnN0IGNvbnRlbnQgPSAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJjb250YWluZXJcIj5cbiAgICAgIDxIZWFkPlxuICAgICAgICA8dGl0bGU+e2hvdXNlLnRpdGxlfTwvdGl0bGU+XG4gICAgICA8L0hlYWQ+XG4gICAgICA8YXJ0aWNsZT5cbiAgICAgICAgPGltZyBzcmM9e2hvdXNlLnBpY3R1cmV9IHdpZHRoPVwiMTAwJVwiIGFsdD1cIkhvdXNlIHBpY3R1cmVcIiAvPlxuICAgICAgICA8cD5cbiAgICAgICAgICB7aG91c2UudHlwZX0gLSB7aG91c2UudG93bn1cbiAgICAgICAgPC9wPlxuICAgICAgICA8cD57aG91c2UudGl0bGV9PC9wPlxuICAgICAgICB7LyogPHA+XG4gICAgICAgICAge2hvdXNlLnJhdGluZ30gKHtob3VzZS5yZXZpZXdzQ291bnR9KVxuICAgICAgICA8L3A+IC8vIHJlbW92ZWQqL31cbiAgICAgIDwvYXJ0aWNsZT5cbiAgICAgIDxhc2lkZT5cbiAgICAgICAgPGgyPkFkZCBkYXRlcyBmb3IgcHJpY2VzLjwvaDI+XG4gICAgICAgIDxEYXRlUmFuZ2VQaWNrZXJcbiAgICAgICAgICBkYXRlc0NoYW5nZWQ9eyhzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgICAgICAgICAgIHNldERhdGVDaG9zZW4odHJ1ZSk7XG4gICAgICAgICAgICBzZXRTdGF5TmlnaHRzKGNhbGN1bGF0ZU5pZ2h0cyhzdGFydERhdGUsIGVuZERhdGUpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG4gICAgICAgICAgICBzZXRTdGFydERhdGUoc3RhcnREYXRlKTtcbiAgICAgICAgICAgIHNldEVuZERhdGUoZW5kRGF0ZSk7XG4gICAgICAgICAgfX1cbiAgICAgICAgICBib29rZWREYXRlcz17Ym9va2VkRGF0ZXN9XG4gICAgICAgIC8+XG4gICAgICAgIHsoZGF0ZUNob3NlbiAmJiAoXG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxoMj5QcmljZSBwZXIgbmlnaHQ8L2gyPlxuICAgICAgICAgICAgPHA+JHtob3VzZS5wcmljZX08L3A+XG4gICAgICAgICAgICA8aDI+VG90YWwgcHJpY2UgZm9yIHRoZSBib29raW5nPC9oMj5cbiAgICAgICAgICAgIDxwPiR7KHN0YXlOaWdodHMgKiBob3VzZS5wcmljZSkudG9GaXhlZCgyKX08L3A+XG4gICAgICAgICAgICB7dXNlciA/IChcbiAgICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInJlc2VydmVcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2FzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICghKGF3YWl0IGNhblJlc2VydmUoaG91c2UuaWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhlIGRhdGVzIGNob3NlbiBhcmUgaW52YWxpZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uUmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgICAgICAgICAgICAgICAgIFwiL2FwaS9zdHJpcGUvc2Vzc2lvblwiLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2UucHJpY2UgKlxuICAgICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRlc0JldHdlZW5EYXRlcyhzdGFydERhdGUsIGVuZERhdGUpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25SZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgYWxlcnQoc2Vzc2lvblJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmlwZVB1YmxpY0tleSA9XG4gICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblJlc3BvbnNlLmRhdGEuc3RyaXBlUHVibGljS2V5O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IHNlc3Npb25SZXNwb25zZS5kYXRhLnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzZXJ2ZVJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgICAgICAgICAgICAgICAgICBcIi9hcGkvaG91c2VzL3Jlc2VydmVcIixcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBob3VzZUlkOiBob3VzZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWRcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFwiL2FwaS9ob3VzZXMvcmVzZXJ2ZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgaG91c2VJZDogaG91c2UuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaXBlID0gU3RyaXBlKHN0cmlwZVB1YmxpY0tleSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN0cmlwZS5yZWRpcmVjdFRvQ2hlY2tvdXQoe1xuICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25JZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIFJlc2VydmVcbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicmVzZXJ2ZVwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgc2V0U2hvd0xvZ2luTW9kYWwoKTtcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgTG9nIGluIHRvIFJlc2VydmVcbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApKSB8fCA8cD5QbGVhc2Ugc2VsZWN0IGRhdGVzPC9wPn1cbiAgICAgIDwvYXNpZGU+XG4gICAgICB7aG91c2UucmV2aWV3c0NvdW50ID8gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJldmlld3NcIj5cbiAgICAgICAgICA8aDM+e2hvdXNlLnJldmlld3NDb3VudH0gUmV2aWV3czwvaDM+XG5cbiAgICAgICAgICB7aG91c2UucmV2aWV3cy5tYXAoKHJldmlldywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0+XG4gICAgICAgICAgICAgICAgPHA+e25ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvRGF0ZVN0cmluZygpfTwvcD5cbiAgICAgICAgICAgICAgICA8cD57cmV2aWV3LmNvbW1lbnR9PC9wPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSA6IChcbiAgICAgICAgPD48Lz5cbiAgICAgICl9XG4gICAgICA8c3R5bGUganN4PntgXG4gICAgICAgIC5jb250YWluZXIge1xuICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiA2MCUgNDAlO1xuICAgICAgICAgIGdyaWQtZ2FwOiAzMHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgYXNpZGUge1xuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XG4gICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgfVxuICAgICAgYH08L3N0eWxlPlxuICAgIDwvZGl2PlxuICApO1xuICByZXR1cm4gPExheW91dCBjb250ZW50PXtjb250ZW50fT48L0xheW91dD47XG59O1xuXG4vLyBIb3VzZS5nZXRJbml0aWFsUHJvcHMgPSAoeyBxdWVyeSB9KSA9PiB7XG4vLyAgIC8vIG91ciBxdWVyeSBpcyB0YWtlbiBmcm9tIHRoZSB1cmxcbi8vICAgY29uc3QgeyBpZCB9ID0gcXVlcnk7IC8vIGhvdXNlcy9xdWVyeVBhcmFtZXRlcnMuIEl0IGlzIGluIHRoZSBmaWxlIG5hbWUgW2lkXS5qc1xuLy8gICBjb25zb2xlLmxvZyhxdWVyeSk7XG4vLyAgIHJldHVybiB7XG4vLyAgICAgaG91c2U6IEhvdXNlcy5maWx0ZXIoaG91c2UgPT4gaG91c2UuaWQgPT09IGlkKVswXVxuLy8gICB9O1xuLy8gfTtcblxuSG91c2UuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgKHsgcXVlcnkgfSkgPT4ge1xuICBjb25zdCB7IGlkIH0gPSBxdWVyeTtcblxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvJHtpZH1gKTtcbiAgY29uc3QgaG91c2UgPSBhd2FpdCByZXMuanNvbigpO1xuXG4gIGNvbnN0IGJvb2tlZERhdGVzID0gYXdhaXQgZ2V0Qm9va2VkRGF0ZXMoaG91c2UpO1xuXG4gIHJldHVybiB7XG4gICAgaG91c2UsXG4gICAgYm9va2VkRGF0ZXNcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEhvdXNlO1xuIl19 */\\n/*@ sourceURL=/home/emil/development/nextbnb/pages/Houses/[id].js */\"));\n\n  return __jsx(Layout, {\n    content: content\n  });\n}; // House.getInitialProps = ({ query }) => {\n//   // our query is taken from the url\n//   const { id } = query; // houses/queryParameters. It is in the file name [id].js\n//   console.log(query);\n//   return {\n//     house: Houses.filter(house => house.id === id)[0]\n//   };\n// };\n\n\nHouse.getInitialProps = function _callee2(_ref3) {\n  var query, id, res, house, bookedDates;\n  return _regeneratorRuntime.async(function _callee2$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          query = _ref3.query;\n          id = query.id;\n          _context4.next = 4;\n          return _regeneratorRuntime.awrap(fetch(\"http://localhost:3000/api/houses/\".concat(id)));\n\n        case 4:\n          res = _context4.sent;\n          _context4.next = 7;\n          return _regeneratorRuntime.awrap(res.json());\n\n        case 7:\n          house = _context4.sent;\n          _context4.next = 10;\n          return _regeneratorRuntime.awrap(getBookedDates(house));\n\n        case 10:\n          bookedDates = _context4.sent;\n          return _context4.abrupt(\"return\", {\n            house: house,\n            bookedDates: bookedDates\n          });\n\n        case 12:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  });\n};\n\nexport default House;","map":{"version":3,"sources":["/home/emil/development/nextbnb/pages/Houses/[id].js"],"names":["axios","fetch","Head","Layout","DateRangePicker","calculateNights","useState","useStoreActions","useStoreState","getBookedDates","house","houseId","id","post","response","data","status","alert","message","dates","console","error","canReserve","startDate","endDate","getDatesBetweenDates","Date","setDate","getDate","House","bookedDates","user","state","setShowLoginModal","actions","modals","dateChosen","setDateChosen","stayNights","setStayNights","setStartDate","setEndDate","content","title","picture","type","town","log","price","toFixed","amount","length","sessionResponse","stripePublicKey","sessionId","reserveResponse","stripe","Stripe","redirectToCheckout","reviewsCount","reviews","map","review","index","createdAt","toDateString","comment","getInitialProps","query","res","json"],"mappings":"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","sourcesContent":["// import Houses from \"../houses.json\";\nimport axios from \"axios\";\nimport fetch from \"isomorphic-unfetch\";\nimport Head from \"next/head\";\nimport Layout from \"../../components/Layout\";\nimport DateRangePicker from \"../../components/DateRangePicker\";\nimport calculateNights from \"../../utils/calculate-nights.js\";\nimport { useState } from \"react\";\nimport { useStoreActions, useStoreState } from \"easy-peasy\";\n// import { Stripe } from \"stripe\";\n\nconst getBookedDates = async house => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\n      \"http://localhost:3000/api/houses/booked\",\n      { houseId }\n    );\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const response = await axios.post(\n      \"http://localhost:3000/api/houses/check\",\n      { houseId, startDate, endDate }\n    );\n    if (response.data.status === \"error\") {\n      alert(response.data.message);\n      return;\n    }\n\n    if (response.data.message === \"busy\") return false;\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst getDatesBetweenDates = (startDate, endDate) => {\n  let dates = [];\n  while (startDate < endDate) {\n    dates = [...dates, new Date(startDate)];\n    startDate.setDate(startDate.getDate() + 1);\n  }\n  dates = [...dates, endDate];\n  return dates;\n};\n\nconst House = ({ house, bookedDates }) => {\n  const user = useStoreState(state => state.user.user);\n  const setShowLoginModal = useStoreActions(\n    actions => actions.modals.setShowLoginModal\n  );\n  const [dateChosen, setDateChosen] = useState(false);\n  const [stayNights, setStayNights] = useState(0);\n  const [startDate, setStartDate] = useState();\n  const [endDate, setEndDate] = useState();\n  const content = (\n    <div className=\"container\">\n      <Head>\n        <title>{house.title}</title>\n      </Head>\n      <article>\n        <img src={house.picture} width=\"100%\" alt=\"House picture\" />\n        <p>\n          {house.type} - {house.town}\n        </p>\n        <p>{house.title}</p>\n        {/* <p>\n          {house.rating} ({house.reviewsCount})\n        </p> // removed*/}\n      </article>\n      <aside>\n        <h2>Add dates for prices.</h2>\n        <DateRangePicker\n          datesChanged={(startDate, endDate) => {\n            setDateChosen(true);\n            setStayNights(calculateNights(startDate, endDate));\n            console.log(startDate, endDate);\n            setStartDate(startDate);\n            setEndDate(endDate);\n          }}\n          bookedDates={bookedDates}\n        />\n        {(dateChosen && (\n          <div>\n            <h2>Price per night</h2>\n            <p>${house.price}</p>\n            <h2>Total price for the booking</h2>\n            <p>${(stayNights * house.price).toFixed(2)}</p>\n            {user ? (\n              <button\n                className=\"reserve\"\n                onClick={async () => {\n                  if (!(await canReserve(house.id, startDate, endDate))) {\n                    alert(\"The dates chosen are invalid\");\n                    return;\n                  }\n\n                  try {\n                    const sessionResponse = await axios.post(\n                      \"/api/stripe/session\",\n                      {\n                        amount:\n                          house.price *\n                          getDatesBetweenDates(startDate, endDate).length\n                      }\n                    );\n                    if (sessionResponse.data.status === \"error\") {\n                      alert(sessionResponse.data.message);\n                      return;\n                    }\n                    const stripePublicKey =\n                      sessionResponse.data.stripePublicKey;\n\n                    const sessionId = sessionResponse.data.sessionId;\n                    const reserveResponse = await axios.post(\n                      \"/api/houses/reserve\",\n                      {\n                        houseId: house.id,\n                        startDate,\n                        endDate,\n                        sessionId\n                      }\n                    );\n\n                    const response = await axios.post(\"/api/houses/reserve\", {\n                      houseId: house.id,\n                      startDate,\n                      endDate,\n                      sessionId\n                    });\n\n                    if (response.data.status === \"error\") {\n                      alert(response.data.message);\n                      return;\n                    }\n                    const stripe = Stripe(stripePublicKey);\n                    const { error } = await stripe.redirectToCheckout({\n                      sessionId\n                    });\n                  } catch (err) {\n                    console.log(err);\n                    return;\n                  }\n                }}\n              >\n                Reserve\n              </button>\n            ) : (\n              <button\n                className=\"reserve\"\n                onClick={() => {\n                  setShowLoginModal();\n                }}\n              >\n                Log in to Reserve\n              </button>\n            )}\n          </div>\n        )) || <p>Please select dates</p>}\n      </aside>\n      {house.reviewsCount ? (\n        <div className=\"reviews\">\n          <h3>{house.reviewsCount} Reviews</h3>\n\n          {house.reviews.map((review, index) => {\n            return (\n              <div key={index}>\n                <p>{new Date(review.createdAt).toDateString()}</p>\n                <p>{review.comment}</p>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <></>\n      )}\n      <style jsx>{`\n        .container {\n          display: grid;\n          grid-template-columns: 60% 40%;\n          grid-gap: 30px;\n        }\n\n        aside {\n          border: 1px solid #ccc;\n          padding: 20px;\n        }\n      `}</style>\n    </div>\n  );\n  return <Layout content={content}></Layout>;\n};\n\n// House.getInitialProps = ({ query }) => {\n//   // our query is taken from the url\n//   const { id } = query; // houses/queryParameters. It is in the file name [id].js\n//   console.log(query);\n//   return {\n//     house: Houses.filter(house => house.id === id)[0]\n//   };\n// };\n\nHouse.getInitialProps = async ({ query }) => {\n  const { id } = query;\n\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n\n  const bookedDates = await getBookedDates(house);\n\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;\n"]},"metadata":{},"sourceType":"module"}